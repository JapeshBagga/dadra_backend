{"version":3,"file":"Redirect-CzAQytdy.js","sources":["../../src/pages/authentication/Redirect.tsx"],"sourcesContent":["import { useEffect } from \"react\";\r\nimport { useNavigate, useParams, useSearchParams } from \"react-router-dom\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { userSlice } from \"../../redux/User\";\r\nimport { axiosPost } from \"../../services/axiosService\";\r\nimport { setCookie } from \"../../services/cookieService\";\r\nimport Environment from \"../../constants/Environment\";\r\nimport Loader from \"../../components/loaders/Loader\";\r\n\r\nfunction Redirect() {\r\n  const dispatch = useDispatch();\r\n  const environmentData = Environment();\r\n  const navigate = useNavigate();\r\n  const { provider } = useParams();\r\n  const [searchParams, _] = useSearchParams();\r\n\r\n  useEffect(() => {\r\n    fetchLoginData();\r\n  }, []);\r\n\r\n  async function fetchLoginData() {\r\n    try {\r\n      const code = searchParams.get(\"code\");\r\n      if (!provider) throw new Error(\"Invalid provider\");\r\n      if (!code) throw new Error(\"Login failed\");\r\n\r\n      const response = await axiosPost(\"/auth/login/oauth\", { code: code, authProvider: provider });\r\n      const { userData, companyData, defaultCompany, token } = response.data.data;\r\n\r\n      setCookie(\"token\", token, 1, environmentData?.PUBLIC_DOMAIN, \"/\");\r\n      setCookie(\"token\", token, 1, environmentData?.PAGE_DOMAIN, \"/\");\r\n\r\n      if (userData.sessionCount < 1) {\r\n        setCookie(\"onBoarding\", \"true\", 1, environmentData?.PUBLIC_DOMAIN, \"/\");\r\n        setCookie(`journey-builder:${userData._id}`, \"true\", 2, environmentData?.PUBLIC_DOMAIN, \"/\");\r\n        setCookie(`journey-dashboard:${userData._id}`, \"true\", 2, environmentData?.PUBLIC_DOMAIN, \"/\");\r\n      }\r\n\r\n      dispatch(\r\n        userSlice.actions.login({\r\n          userId: userData._id,\r\n          userName: userData.userName,\r\n          userEmail: userData.userEmail,\r\n          userPhone: userData.userPhone,\r\n          sessionCount: userData.sessionCount,\r\n          defaultCompany: defaultCompany,\r\n          companyDetails: {\r\n            _id: companyData._id,\r\n            compName: companyData.compName,\r\n            userId: companyData.userId,\r\n            count: companyData.count,\r\n            subDomain: companyData.subDomain,\r\n            createdAt: companyData.createdAt,\r\n            updatedAt: companyData.updatedAt,\r\n          },\r\n        })\r\n      );\r\n      navigate(\"/dashboard\");\r\n    } catch (err: any) {\r\n      dispatch(\r\n        userSlice.actions.setToastPopUp({\r\n          show: true,\r\n          toastType: \"error\",\r\n          message: err.response?.data?.message ?? err?.message ?? \"Something went wrong\",\r\n        })\r\n      );\r\n      navigate(\"/login\");\r\n    }\r\n  }\r\n\r\n  return <Loader />;\r\n}\r\n\r\nexport default Redirect;\r\n"],"names":["Redirect","dispatch","useDispatch","environmentData","Environment","navigate","useNavigate","provider","useParams","searchParams","_","useSearchParams","useEffect","fetchLoginData","code","response","axiosPost","userData","companyData","defaultCompany","token","setCookie","userSlice","err","_b","_a","Loader"],"mappings":"8GASA,SAASA,GAAW,CAClB,MAAMC,EAAWC,IACXC,EAAkBC,IAClBC,EAAWC,IACX,CAAE,SAAAC,GAAaC,IACf,CAACC,EAAcC,CAAC,EAAIC,EAAgB,EAE1CC,EAAAA,UAAU,IAAM,CACCC,GACjB,EAAG,CAAE,CAAA,EAEL,eAAeA,GAAiB,SAC1B,GAAA,CACI,MAAAC,EAAOL,EAAa,IAAI,MAAM,EACpC,GAAI,CAACF,EAAgB,MAAA,IAAI,MAAM,kBAAkB,EACjD,GAAI,CAACO,EAAY,MAAA,IAAI,MAAM,cAAc,EAEnC,MAAAC,EAAW,MAAMC,EAAU,oBAAqB,CAAE,KAAAF,EAAY,aAAcP,EAAU,EACtF,CAAE,SAAAU,EAAU,YAAAC,EAAa,eAAAC,EAAgB,MAAAC,CAAM,EAAIL,EAAS,KAAK,KAEvEM,EAAU,QAASD,EAAO,EAAGjB,GAAA,YAAAA,EAAiB,cAAe,GAAG,EAChEkB,EAAU,QAASD,EAAO,EAAGjB,GAAA,YAAAA,EAAiB,YAAa,GAAG,EAE1Dc,EAAS,aAAe,IAC1BI,EAAU,aAAc,OAAQ,EAAGlB,GAAA,YAAAA,EAAiB,cAAe,GAAG,EAC5DkB,EAAA,mBAAmBJ,EAAS,GAAG,GAAI,OAAQ,EAAGd,GAAA,YAAAA,EAAiB,cAAe,GAAG,EACjFkB,EAAA,qBAAqBJ,EAAS,GAAG,GAAI,OAAQ,EAAGd,GAAA,YAAAA,EAAiB,cAAe,GAAG,GAG/FF,EACEqB,EAAU,QAAQ,MAAM,CACtB,OAAQL,EAAS,IACjB,SAAUA,EAAS,SACnB,UAAWA,EAAS,UACpB,UAAWA,EAAS,UACpB,aAAcA,EAAS,aACvB,eAAAE,EACA,eAAgB,CACd,IAAKD,EAAY,IACjB,SAAUA,EAAY,SACtB,OAAQA,EAAY,OACpB,MAAOA,EAAY,MACnB,UAAWA,EAAY,UACvB,UAAWA,EAAY,UACvB,UAAWA,EAAY,SACzB,CAAA,CACD,CAAA,EAEHb,EAAS,YAAY,QACdkB,EAAU,CACjBtB,EACEqB,EAAU,QAAQ,cAAc,CAC9B,KAAM,GACN,UAAW,QACX,UAASE,GAAAC,EAAAF,EAAI,WAAJ,YAAAE,EAAc,OAAd,YAAAD,EAAoB,WAAWD,GAAA,YAAAA,EAAK,UAAW,sBAAA,CACzD,CAAA,EAEHlB,EAAS,QAAQ,CACnB,CACF,CAEA,gBAAQqB,EAAD,CAAA,EAAA,OAAA,GAAA,CAAA,SAAA,sGAAA,WAAA,GAAA,aAAA,EAAQ,EAAA,IAAA,CACjB"}