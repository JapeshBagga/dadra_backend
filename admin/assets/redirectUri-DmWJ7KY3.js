import{a as k,u as y,o as S,r as l,p as V,e as p,d as h,j as e,J as L,i as P}from"./index-COdFNi2n.js";import{a as I}from"./store-BjiLABx5.js";function F(){const m=k(),t=y(),{integrationType:i}=S(),[b,N]=l.useState(!0),[g]=V(),[D,v]=l.useState(!1),d=I(s=>s.setOpenConfigModalId),[E,x]=l.useState(!1),O=g.get("state")??"{}";let{prevUrl:o,forced:U}=JSON.parse(O);o=o?o+"?tab=configure":"/dashboard",l.useEffect(()=>{j(i)},[]);async function w(s,n){var c,a;try{(await p("/configurations/emailConfig/"+s,{code:n})).status==200&&v(!0)}catch(r){m(h.actions.setToastPopUp({show:!0,toastType:"error",message:((a=(c=r.response)==null?void 0:c.data)==null?void 0:a.message)??(r==null?void 0:r.message)??"Something went wrong"})),console.log(r)}finally{N(!1),setTimeout(()=>{f()},2e3)}}async function j(s){const n=g.get("code");if(!n)throw new Error("Login failed, Invalid code");if(!s)throw new Error("Invalid Integration Type");s==="gmail"||s==="outlook"?await w(s,n):s==="whatsapp"||s==="facebook"?await C():t("/dashboard")}async function C(){var s,n,c;try{const a=g.get("code");if(!i)throw new Error("Invalid provider");if(!a)throw new Error("Unable to connect whatsapp business account");const r=await p(`/users/setAppConfig?forced=${U??!1}`,{code:a,siteName:i});if(i==="whatsapp"){if(((s=r==null?void 0:r.data)==null?void 0:s.success)===!1){x(!0);return}d("whatsapp")}i==="facebook"&&d("facebook"),t(o)}catch(a){t(o),m(h.actions.setToastPopUp({show:!0,toastType:"error",message:((c=(n=a.response)==null?void 0:n.data)==null?void 0:c.message)??(a==null?void 0:a.message)??"Something went wrong"}))}}const u=s=>{if(!s){t(o);return}t(o+"&forced=true"),d("whatsapp")},f=()=>{window.close()};return E?e.jsxDEV(L,{onConfirm:()=>u(!0),onCancel:()=>u(!1),content:{title:"Whatsapp account already connected to Omniengage",message:"This whatsapp account is already connected to another company. Do you want to logout from previous company and login here? *You will need to re-login Meta if you click yes"}},void 0,!1,{fileName:"C:/Users/japba/OneDrive/Desktop/OmniEngage/og-engage-frontend/src/pages/redirectUri.tsx",lineNumber:121,columnNumber:7},this):e.jsxDEV(e.Fragment,{children:b?e.jsxDEV(P,{},void 0,!1,{fileName:"C:/Users/japba/OneDrive/Desktop/OmniEngage/og-engage-frontend/src/pages/redirectUri.tsx",lineNumber:136,columnNumber:9},this):D?e.jsxDEV(e.Fragment,{children:e.jsxDEV("h1",{children:"Login Successfully"},void 0,!1,{fileName:"C:/Users/japba/OneDrive/Desktop/OmniEngage/og-engage-frontend/src/pages/redirectUri.tsx",lineNumber:139,columnNumber:11},this)},void 0,!1,{fileName:"C:/Users/japba/OneDrive/Desktop/OmniEngage/og-engage-frontend/src/pages/redirectUri.tsx",lineNumber:138,columnNumber:9},this):e.jsxDEV(e.Fragment,{children:e.jsxDEV("div",{id:"redirect-error",className:"modal fade",role:"dialog",children:e.jsxDEV("div",{className:"modal-dialog",children:e.jsxDEV("div",{className:"modal-content modal-bg",children:e.jsxDEV("div",{className:"modal-body text-center",children:e.jsxDEV("div",{id:"error",className:"",children:[e.jsxDEV("p",{className:"subheading",children:["Sorry we were not able to process this request.",e.jsxDEV("br",{},void 0,!1,{fileName:"C:/Users/japba/OneDrive/Desktop/OmniEngage/og-engage-frontend/src/pages/redirectUri.tsx",lineNumber:150,columnNumber:23},this),"Please try again."]},void 0,!0,{fileName:"C:/Users/japba/OneDrive/Desktop/OmniEngage/og-engage-frontend/src/pages/redirectUri.tsx",lineNumber:148,columnNumber:21},this),e.jsxDEV("button",{type:"button",className:"btn btn-close btn-hover hide",onClick:f,children:"Close"},void 0,!1,{fileName:"C:/Users/japba/OneDrive/Desktop/OmniEngage/og-engage-frontend/src/pages/redirectUri.tsx",lineNumber:153,columnNumber:21},this)]},void 0,!0,{fileName:"C:/Users/japba/OneDrive/Desktop/OmniEngage/og-engage-frontend/src/pages/redirectUri.tsx",lineNumber:147,columnNumber:19},this)},void 0,!1,{fileName:"C:/Users/japba/OneDrive/Desktop/OmniEngage/og-engage-frontend/src/pages/redirectUri.tsx",lineNumber:146,columnNumber:17},this)},void 0,!1,{fileName:"C:/Users/japba/OneDrive/Desktop/OmniEngage/og-engage-frontend/src/pages/redirectUri.tsx",lineNumber:145,columnNumber:15},this)},void 0,!1,{fileName:"C:/Users/japba/OneDrive/Desktop/OmniEngage/og-engage-frontend/src/pages/redirectUri.tsx",lineNumber:144,columnNumber:13},this)},void 0,!1,{fileName:"C:/Users/japba/OneDrive/Desktop/OmniEngage/og-engage-frontend/src/pages/redirectUri.tsx",lineNumber:143,columnNumber:11},this)},void 0,!1,{fileName:"C:/Users/japba/OneDrive/Desktop/OmniEngage/og-engage-frontend/src/pages/redirectUri.tsx",lineNumber:142,columnNumber:9},this)},void 0,!1,{fileName:"C:/Users/japba/OneDrive/Desktop/OmniEngage/og-engage-frontend/src/pages/redirectUri.tsx",lineNumber:134,columnNumber:5},this)}export{F as default};
//# sourceMappingURL=redirectUri-DmWJ7KY3.js.map
